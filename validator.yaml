extractor:
  # DSSP execution
  dssp_timeout_sec: 10

  # Segment construction (continuous DSSP 'E')
  jump_tolerance: 4
  min_segment_len: 3

  # AlphaFold pLDDT inference from CA B-factor (0..100)
  # Only activates when B-factor distribution looks like pLDDT (predicted models),
  # to avoid gating experimental structures.
  plddt_detection:
    enable: true
    bfactor_min: 0.0
    bfactor_max: 100.0
    median_min: 50.0
    p90_min: 70.0

analyzer:
  score_threshold: 0.60 

  penalties:

    ring_cv:     {thr_small: 0.25, thr_large: 0.30, mult_small: 1.5, mult_large: 1.2}
    thickness:   {thr_small: 0.30, thr_large: 0.35, mult_small: 1.5, mult_large: 1.2}
    surface_rmse_norm: {thr: 0.35, mult: 1.0}


    z_profile:   {thr_cv: 0.40, penalty: 0.10}
    segments:    {min_segments: 2, penalty: 0.10}
    fallback:    {penalty: 0.05}

    kurtosis:
      thick_thr: 0.40
      kurtosis_thr: -1.5
      penalty_if_thick: 0.20
      penalty_else: 0.05

# Topology / DSSP derived checks
# (using strand ordering produced by geometry.cleaner+topology)

_topology_common:
  # Strong H-bond definition (DSSP energy cutoff, kcal/mol)
  energy_cutoff: -0.5
  min_hbonds_per_edge: 2

  # Mapping aligned strand coords back to residues via KDTree
  nn_dist_tol: 0.75

  # Radial unimodality detection
  radial_min_rel_height: 0.15

validator:
  # Global confidence threshold applied after topology_quality scaling
  confidence_threshold: 0.60

  # Optional combined topology quality scaling (0..1) applied to confidence
  topology_quality:
    enable: true
    apply_to_confidence: true
    components:
      - name: graph_cyclicity
        weight: 1.0
        transform: clip01
      - name: graph_connected
        weight: 1.0
        transform: clip01
      - name: degree2_fraction
        weight: 1.0
        transform: clip01
      - name: radial_unimodal_score
        weight: 1.0
        transform: clip01
      - name: edge_hbond_cv
        weight: 1.0
        transform: inv1p
      - name: registry_shift_edge_mean_std
        weight: 1.0
        transform: exp_decay
        scale: 3.0
      - name: tilt_angle_std_deg
        weight: 1.0
        transform: exp_decay
        scale: 25.0
      - name: vector_alt_score
        weight: 1.0
        transform: neg_clip01

  # Optional pLDDT gate (only when extractor marks plddt_active=1)
  plddt_gate:
    enable: true
    threshold: 0.70
    mean_min: 0.70
    pass_fraction_min: 0.85

  # Hard-fail logic (conservative defaults)
  hard_fail:
    cyclicity_required: 1.0
    graph_connected_required: 1.0
    degree2_fraction_min: 0.75

    vector_alt_max: -0.25     # fail if vector_alt_score > this

    radial_unimodal_min: 0.50
    tilt_std_max_deg: 30.0

    registry_std_max: 4.0

    hbond_uniformity:
      mean_min: 2.0
      cv_max: 1.2

  # If still valid after hard checks, enforce the final confidence threshold
  enforce_confidence_threshold: true

